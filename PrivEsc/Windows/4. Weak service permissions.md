Often, we can find applications that run with SYSTEM privileges in a windows environment. To find the list of services running in a windows system, we can use the command `wmic service list brief` or view them from task manager.
If a service has 'weak permissions' i.e. if a low privilege user has write permision on the folder of the exe, an attacker can replace the executable with a malicious one and gain elevated privileges. 

### Requirements
- Service running as SYSTEM.
- Write permission to the folder of the executable.

# Finding vulnerable services

.. code-block:: none

    for /f "tokens=2 delims='='" %a in ('wmic service list full^|find /i "pathname"^|find /i /v "system32"') do @echo %a >> c:\windows\temp\services.txt
	
Alternately, if winmc is not available, 

.. code-block:: none

    sc query state= all | findstr "SERVICE_NAME:" >> servicenames.txt
    FOR /F "tokens=2 delims= " %i in (servicenames.txt) DO @echo %i >> services.txt
    FOR /F %i in (services.txt) DO @sc qc %i | findstr "BINARY_PATH_NAME" >> path.txt
	
With accesschk results, look for the following permissions:

.. csv-table::
    :header: "Permission", "Use Case"

    "SERVICE_ALL_ACCESS", "Can do anything."
    "SERVICE_CHANGE_CONFIG", "Can reconfigure the service binary."
    "WRITE DAC", "Can reconfigure permissions, leading to SERVICE_CHANGE_CONFIG."
    "WRITE_OWNER", "Can become owner, reconfigure permissions."
    "GENERIC_WRITE", "Inherits SERVICE_CHANGE_CONFIG"
    "GENERIC_ALL", "Inherits SERVICE_CHANGE_CONFIG"

With cacls and icacls, look for (F)ull Access, (M)odify access, (W)rite-only access, (WDAC) write DAC, or (WO) write owner.

# Resources
1. [This](http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/) blog post by travisltman.
2. [This](https://www.youtube.com/watch?v=66Xp0KpNr-0) video by conda.